<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Baby Room Monitor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ============== LOGIN ============== -->
  <div id="loginForm" class="page login-page">
    <div class="login-shell">

      <section class="login-left">
        <div class="login-brand">
          <span class="logo-mark">üë∂</span>
          <span class="logo-text">Baby Room Monitor</span>
        </div>

        <h1 class="login-heading">Welcome</h1>
        <p class="login-sub">
          Silakan login untuk mengakses panel monitoring.
        </p>

        <form class="login-form" onsubmit="return false;">
          <label for="email">Email</label>
          <input type="email" id="email" placeholder="Email address"/>
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="Password" />
          <button id="loginBtn" type="button">Login</button>
        </form>
      </section>

      <section class="login-right">
        <img src="assets/baby1.jpg" alt="baby room background" class="bg-plant">
        <div class="visual-layer">
          <div class="visual-card">
            <div class="visual-logo">üë∂</div>
            <p class="visual-title">Baby Room</p>
            <p class="visual-caption">
              Monitoring suhu, kelembapan, dan kondisi kamar bayi.
            </p>
          </div>
        </div>
      </section>

    </div>
  </div>

  <!-- ============== DASHBOARD ============== -->
  <div id="dashboard" class="page page-dashboard" style="display: none;">
    <header class="dash-header">
      <div class="dash-title">
        <h1>Baby Room Monitor</h1>
        <h2>Monitoring Suhu, Kelembapan, &amp; Kondisi Kamar Bayi</h2>
      </div>
      <button id="logoutBtn" class="btn-ghost">Logout</button>
    </header>
  <main class="dash-main">
  <section class="dash-hero">
    <img src="assets/baby1.jpg" alt="Baby room background" class="hero-bg">

    <div class="hero-overlay">
      <div class="metric-row">
        <!-- KIRI: SUHU -->
        <div class="metric-card metric-toggle" data-metric="temperature">
          <div class="metric-icon">üå°Ô∏è</div>
          <div class="metric-title">Suhu Ruangan</div>
          <div class="metric-value">
            <span id="temperatureValue">0</span><span class="metric-unit">¬∞C</span>
          </div>
          <div class="metric-status" id="temperatureStatus">Normal</div>
        </div>

        <!-- TENGAH: KELEMBAPAN -->
        <div class="metric-card metric-toggle" data-metric="humidity">
          <div class="metric-icon">üíß</div>
          <div class="metric-title">Kelembapan Udara</div>
          <div class="metric-value">
            <span id="humidityValue">0</span><span class="metric-unit">%</span>
          </div>
          <div class="metric-status" id="humidityStatus">Normal</div>
        </div>

        <!-- KANAN: STATUS RUANGAN -->
        <div class="metric-card metric-toggle" data-metric="status">
          <div class="metric-icon">üè†</div>
          <div class="metric-title">Status Ruangan</div>
          <div class="metric-value" id="statusText">NYAMAN</div>
          <div class="metric-status" id="statusDesc">Kondisi Aman</div>
        </div>

        <!-- LINGKARAN BESAR YANG PINDAH-PINDAH -->
        <div class="hero-circle" id="heroCircle">
          <div class="hero-circle-inner">
            <div class="circle-icon">üå°Ô∏è</div>
            <div class="circle-label" id="heroLabel">Suhu Ruangan</div>
            <div class="circle-value" id="heroValue">
              0<span class="metric-unit">¬∞C</span>
            </div>
            <div class="circle-chip" id="heroStatus">Normal</div>
          </div>
        </div>
      </div>
    </div>
  </section>

    <!-- ROW KARTU DI BAWAH-->
    <section class="dash-grid">
      <article class="dash-card">
        <h3>Suhu &amp; Kenyamanan</h3>
        <p>
          Suhu ideal untuk bayi adalah 18-30¬∞C.
        </p>
      </article>

      <article class="dash-card">
        <h3>Kelembapan Udara</h3>
        <p>
          Kelembapan optimal untuk kenyamanan bayi adalah 40-60%. <br>Udara yang
          terlalu kering atau lembap dapat mengganggu pernapasan bayi.
        </p>
      </article>

      <article class="dash-card">
        <h3>Status &amp; Peringatan</h3>
        <p>
          LED akan aktif jika kondisi tidak aman.<br> Hijau = Nyaman,
          Kuning = Waspada, Merah = Bahaya.
        </p>
      </article>
    </section>
  </main>


    <footer class="dash-footer">
      <p>
        Baby Room Monitor &mdash; Dashboard monitoring berbasis
        Firebase Realtime Database.
      </p>
    </footer>
  </div>

    <!-- ============== JS (Firebase + Logic) ============== -->
    <script type="module">
      // Import Firebase SDK 
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged        
      } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        onValue
      } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

      // Config project firebase
      const firebaseConfig = {
        apiKey: "AIzaSyDl1eKmOoJP3TVL9rcOa029Vy9njROPGXI",
        authDomain: "smart-plant-green-house.firebaseapp.com",
        projectId: "smart-plant-green-house",
        storageBucket: "smart-plant-green-house.firebasestorage.app",
        messagingSenderId: "978210883222",
        appId: "1:978210883222:web:481a78ff79dba5257864b7",
        databaseURL: "https://smart-plant-green-house-default-rtdb.asia-southeast1.firebasedatabase.app"
      };

      // Init Firebase
      const app  = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db   = getDatabase(app);

      const loginFormEl = document.getElementById("loginForm");
      const dashboardEl = document.getElementById("dashboard");
      const loginBtn    = document.getElementById("loginBtn");
      const logoutBtn   = document.getElementById("logoutBtn");

      // AUTO LOGIN DETECTOR
      onAuthStateChanged(auth, (user) => {
        if (user) {
          loginFormEl.style.display = "none";
          dashboardEl.style.display = "block";
          listenToSensors(); // load realtime data
        } else {
          loginFormEl.style.display = "flex";
          dashboardEl.style.display = "none";
        }
      });

      // ====== STATE & FUNGSI UNTUK LINGKARAN HERO ======
      let currentMetric = "temperature"; 
      let tempVal = 0;
      let tempStatus = "Normal";

      let humidityVal = 0;
      let humidityStatus = "Normal";

      let statusVal = "NYAMAN";
      let statusDesc = "Kondisi Aman";

      const heroCircle   = document.getElementById("heroCircle");
      const heroValueEl  = document.getElementById("heroValue");
      const heroLabelEl  = document.getElementById("heroLabel");
      const heroStatusEl = document.getElementById("heroStatus");

      function moveCircleTo(metric) {
        if (!heroCircle) return;

        if (metric === "temperature") {
          heroCircle.style.left = "16%";
        } else if (metric === "humidity") {
          heroCircle.style.left = "50%";
        } else if (metric === "status") {
          heroCircle.style.left = "84%";
        }
      }

      function refreshHeroByMetric() {
        currentMetric = currentMetric || "temperature";

        document.querySelectorAll(".metric-toggle").forEach(card => {
          card.classList.toggle("active", card.dataset.metric === currentMetric);
        });

        moveCircleTo(currentMetric);

        if (!heroValueEl || !heroLabelEl || !heroStatusEl) return;

        // AMBIL ELEMEN ICON DI LINGKARAN
        const circleIconEl = document.querySelector(".circle-icon"); 

        if (currentMetric === "temperature") {
          heroValueEl.innerHTML  = tempVal + '<span class="metric-unit">¬∞C</span>';
          heroLabelEl.textContent  = "Suhu Ruangan";
          heroStatusEl.textContent = tempStatus;
          if (circleIconEl) circleIconEl.textContent = "üå°Ô∏è";  

        } else if (currentMetric === "humidity") {
          heroValueEl.innerHTML  = humidityVal + '<span class="metric-unit">%</span>';
          heroLabelEl.textContent  = "Kelembapan Udara";
          heroStatusEl.textContent = humidityStatus;
          if (circleIconEl) circleIconEl.textContent = "üíß";   

        } else if (currentMetric === "status") {
          heroValueEl.innerHTML  = statusVal;
          heroLabelEl.textContent  = "Status Ruangan";
          heroStatusEl.textContent = statusDesc;
          if (circleIconEl) circleIconEl.textContent = "üè†";  
        }
      }


      // LOGIN DAN LOGOUT
      loginBtn.addEventListener("click", () => {
        const email = document.getElementById("email").value;
        const pass  = document.getElementById("password").value;

        signInWithEmailAndPassword(auth, email, pass)
          .then(() => {
            loginFormEl.style.display = "none";
            dashboardEl.style.display = "block";
            listenToSensors();
          })
          .catch(err => alert("Login gagal: " + err.message));
      });

      logoutBtn.addEventListener("click", () => {
        signOut(auth).then(() => {
          const form = document.querySelector(".login-form");
          if (form) form.reset();
        });
      });

      // MENAMPILKAN DATA SENSOR (Realtime Database)
      function listenToSensors() {
        const sensorRef = ref(db, "iot");

        onValue(sensorRef, (snapshot) => {
          const d = snapshot.val() || {};

          updateTemperature(d.temperature ?? 0);
          updateHumidity(d.humidity ?? 0);
          updateStatus(d.status ?? "NYAMAN");
        });
      }

      function updateTemperature(value) {
        tempVal = value;
        
        // Status berdasarkan suhu ideal bayi
        if (value < 18 || value > 30) {
          tempStatus = "Bahaya";
        } else if (value >= 18 && value <= 20) {
          tempStatus = "Sejuk";
        } else if (value >= 21 && value <= 27) {
          tempStatus = "Optimal";
        } else {
          tempStatus = "Hangat";
        }

        const tempValEl    = document.getElementById("temperatureValue");
        const tempStatusEl = document.getElementById("temperatureStatus");
        if (tempValEl)    tempValEl.innerText    = value;
        if (tempStatusEl) tempStatusEl.innerText = tempStatus;

        refreshHeroByMetric();
      }

      function updateHumidity(value) {
        humidityVal = value;
        
        // Status berdasarkan kelembapan ideal bayi
        if (value < 30 || value > 70) {
          humidityStatus = "Bahaya";
        } else if (value >= 30 && value < 40) {
          humidityStatus = "Rendah";
        } else if (value >= 40 && value <= 60) {
          humidityStatus = "Optimal";
        } else {
          humidityStatus = "Tinggi";
        }

        const humidityValEl    = document.getElementById("humidityValue");
        const humidityStatusEl = document.getElementById("humidityStatus");
        if (humidityValEl)    humidityValEl.innerText    = value;
        if (humidityStatusEl) humidityStatusEl.innerText = humidityStatus;

        refreshHeroByMetric();
      }

      function updateStatus(value) {
        statusVal = value;
        
        // Deskripsi status dari ESP32
        if (value === "BAHAYA") {
          statusDesc = "Kondisi Berbahaya";
        } else if (value === "WASPADA") {
          statusDesc = "Perlu Perhatian";
        } else {
          statusDesc = "Kondisi Aman";
        }

        const statusTextEl = document.getElementById("statusText");
        const statusDescEl = document.getElementById("statusDesc");
        
        if (statusTextEl) statusTextEl.innerText = value;
        if (statusDescEl) statusDescEl.innerText = statusDesc;

        refreshHeroByMetric();
      }

      document.querySelectorAll(".metric-toggle").forEach(card => {
        card.addEventListener("click", () => {
          currentMetric = card.dataset.metric;
          refreshHeroByMetric();
        });
      });
      refreshHeroByMetric();
    </script>
  </body>
</html>